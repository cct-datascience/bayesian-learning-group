{
  "hash": "9320eadcfcb029011233c6b75ec9af97",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Categorical models and model comparison\"\neditor: source\nfreeze: true\n---\n\n\n## Adding categorical predictors\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(palmerpenguins)\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'dplyr'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(ggdist)\nlibrary(brms)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: Rcpp\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading 'brms' package (version 2.21.0). Useful instructions\ncan be found by typing help('brms'). A more detailed introduction\nto the package is available through vignette('brms_overview').\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'brms'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:ggdist':\n\n    dstudent_t, pstudent_t, qstudent_t, rstudent_t\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:stats':\n\n    ar\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(tidybayes)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'tidybayes'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:brms':\n\n    dstudent_t, pstudent_t, qstudent_t, rstudent_t\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(tidyr)\ntheme_set(theme_minimal())\n\npenguins <- penguins |>\n  filter(!is.na(sex),\n         species == \"Chinstrap\") \n\nggplot(penguins, aes(bill_depth_mm, \n                     bill_length_mm, \n                     color = sex)) +\n  geom_point()\n```\n\n::: {.cell-output-display}\n![](categorical_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n### The model\n\n-   Say we want to model `bill_length` as a function of both `bill_depth` and `sex`.\n-   There are different approaches to adding a categorial predictor to a model, sometimes called \"indicator\" (or \"dummy\") variables, or \"index\" variables. McElreath comes down strongly in favor of using \"index\" variables. For more discussion, see [here](https://bookdown.org/content/4857/the-many-variables-the-spurious-waffles.html#categorical-variables) and links therein.\n\n### The code\n\n### Fitting the model\n\nFirst we can fit a model that will just fit different *intercepts* for the different species:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndepth_length_sex_brm <- brm(\n  family = gaussian,\n  data = penguins,\n  formula = bill_depth_mm ~ 0 + bill_length_mm + sex,\n  prior = c(\n      prior(normal(0, 5), class = b),\n      prior(uniform(0, 20), class = sigma, ub = 20)),\n  iter = 1000\n)\n```\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n### Interpreting the model\n\nModel diagnostics:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(depth_length_sex_brm)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n Family: gaussian \n  Links: mu = identity; sigma = identity \nFormula: bill_depth_mm ~ 0 + bill_length_mm + sex \n   Data: penguins (Number of observations: 68) \n  Draws: 4 chains, each with iter = 1000; warmup = 500; thin = 1;\n         total post-warmup draws = 2000\n\nRegression Coefficients:\n               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS\nbill_length_mm     0.16      0.04     0.09     0.23 1.01      356      391\nsexfemale         10.28      1.67     7.00    13.64 1.01      356      399\nsexmale           11.24      1.83     7.60    14.84 1.01      361      388\n\nFurther Distributional Parameters:\n      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS\nsigma     0.77      0.07     0.65     0.92 1.00      545      664\n\nDraws were sampled using sampling(NUTS). For each parameter, Bulk_ESS\nand Tail_ESS are effective sample size measures, and Rhat is the potential\nscale reduction factor on split chains (at convergence, Rhat = 1).\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(depth_length_sex_brm)\n```\n\n::: {.cell-output-display}\n![](categorical_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nComparing the intercepts for `sex`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nas_draws_df(depth_length_sex_brm) %>% \n  mutate(diff_fm = b_sexfemale - b_sexmale) %>% \n  pivot_longer(cols = c(b_sexfemale:sigma, diff_fm)) %>% \n  group_by(name) %>% \n  mean_qi(value, .width = .89)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Dropping 'draws_df' class as required metadata was removed.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 Ã— 7\n  name         value .lower .upper .width .point .interval\n  <chr>        <dbl>  <dbl>  <dbl>  <dbl> <chr>  <chr>    \n1 b_sexfemale 10.3    7.64  12.9     0.89 mean   qi       \n2 b_sexmale   11.2    8.31  14.1     0.89 mean   qi       \n3 diff_fm     -0.960 -1.34  -0.564   0.89 mean   qi       \n4 sigma        0.772  0.670  0.889   0.89 mean   qi       \n```\n\n\n:::\n:::\n\n\n### Model comparison\n\nSee chapter 7 and the bookdown book [here](https://bookdown.org/content/4857/ulysses-compass.html) for more on model comparison criteria.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndepth_length_sex_brm <- depth_length_sex_brm |> add_criterion(criterion = c(\"waic\", \"loo\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: \n2 (2.9%) p_waic estimates greater than 0.4. We recommend trying loo instead.\n```\n\n\n:::\n\n```{.r .cell-code}\ndepth_length_sex_brm$criteria\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$waic\n\nComputed from 2000 by 68 log-likelihood matrix.\n\n          Estimate   SE\nelpd_waic    -80.2  5.7\np_waic         4.1  1.3\nwaic         160.3 11.3\n\n2 (2.9%) p_waic estimates greater than 0.4. We recommend trying loo instead. \n\n$loo\n\nComputed from 2000 by 68 log-likelihood matrix.\n\n         Estimate   SE\nelpd_loo    -80.3  5.7\np_loo         4.2  1.4\nlooic       160.5 11.4\n------\nMCSE of elpd_loo is 0.2.\nMCSE and ESS estimates assume MCMC draws (r_eff in [0.2, 1.1]).\n\nAll Pareto k estimates are good (k < 0.7).\nSee help('pareto-k-diagnostic') for details.\n```\n\n\n:::\n:::\n\n\nCompare this to our old model, with no term for sex:\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndepth_length_brm <- depth_length_brm |> add_criterion(criterion = c(\"waic\", \"loo\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: \n1 (1.5%) p_waic estimates greater than 0.4. We recommend trying loo instead.\n```\n\n\n:::\n\n```{.r .cell-code}\ndepth_length_brm$criteria\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$waic\n\nComputed from 2000 by 68 log-likelihood matrix.\n\n          Estimate   SE\nelpd_waic    -89.2  6.8\np_waic         3.6  1.7\nwaic         178.4 13.5\n\n1 (1.5%) p_waic estimates greater than 0.4. We recommend trying loo instead. \n\n$loo\n\nComputed from 2000 by 68 log-likelihood matrix.\n\n         Estimate   SE\nelpd_loo    -89.2  6.8\np_loo         3.6  1.7\nlooic       178.4 13.5\n------\nMCSE of elpd_loo is 0.1.\nMCSE and ESS estimates assume MCMC draws (r_eff in [0.7, 1.0]).\n\nAll Pareto k estimates are good (k < 0.7).\nSee help('pareto-k-diagnostic') for details.\n```\n\n\n:::\n:::\n",
    "supporting": [
      "categorical_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}