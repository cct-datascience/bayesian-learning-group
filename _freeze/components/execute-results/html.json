{
  "hash": "d3ca113f9970d8d7a13a7ded13462404",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Components of a model\"\neditor: source\nfreeze: true\n---\n\n\nBased on the book section [4.2. A language for describing models](https://learning.oreilly.com/library/view/statistical-rethinking-2nd/9780429639142/xhtml/06_Contents.xhtml#sec4_2).\n\n## Variables\n\n### Data\n\nObservable things.\n\n### Parameters\n\nNot observable or known.\n\n## \"Joint generative model\"\n\nWe define each variable either in terms of a probability distribution, or in terms of its relationship to the other variables.\n\nTaken together, this system of definitions is what McElreath calls a \"joint generative model\".\n\n## Penguins example\n\nLet's model `bill_length` for Chinstrap penguins.\nFirst, we won't use any predictor variables - just looking for the mean.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(palmerpenguins)\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'dplyr'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(ggdist)\ntheme_set(theme_minimal())\n\npenguins <- penguins |>\n  filter(!is.na(sex)) |>\n  filter(species == \"Chinstrap\") \n\nggplot(penguins, aes(bill_depth_mm)) +\n  geom_dotsinterval()\n```\n\n::: {.cell-output-display}\n![](components_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n### Defining the model\n\n$\\text{billdepth}_i \\sim N(\\mu, \\sigma)$\n\nThis just says that bill depth is normally distributed with some mean and some standard deviation.\nWe can observe bill depth (data), but we don't know the mean or standard deviation (parameters).\n\nFor the parameters, we need *priors*.\n\n$\\mu \\sim N(50, 15)$\n\nThis is to say that $\\mu$ is some number drawn from a normal distribution centered on 50:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata.frame(mu = rnorm(1000, mean = 20, sd = 6)) |>\n  ggplot(aes(x = mu)) +\n  geom_dotsinterval() +\n  ggtitle(\"Simulations from prior for mu\")\n```\n\n::: {.cell-output-display}\n![](components_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n\\$\\sigma \\sim \\text{Uniform}(0, 20)\\$\n\nAnd here we're saying that we figure $sigma$ is potentially uniformly distributed ranging from 0-20.\nStandard deviations have to be positive, and otherwise this is a very broad range.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata.frame(sigma = runif(1000, 0, 20)) |>\n  ggplot(aes(x = sigma)) +\n  geom_dotsinterval() +\n  ggtitle(\"Simulations from prior for sigma\")\n```\n\n::: {.cell-output-display}\n![](components_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n### Exploring the generative model\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsample_mu <- rnorm(1000, 20, 6)\nsample_sigmas <- runif(1000, 0, 20)\n\ndata.frame(simulated_bill_depths = \n             rnorm(1000, \n                   sample_mu,\n                   sample_sigmas)) |>\n  ggplot(aes(simulated_bill_depths)) +\n  geom_dotsinterval() +\n  ggtitle(\"Simlated bill depths from priors\")\n```\n\n::: {.cell-output-display}\n![](components_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nThis is our simulation of expected bill depths *before explicitly taking into account the data* (although we did look at the density plot before specifying the priors).\n\n### Taking into account the data\n\nSee [here](https://bookdown.org/content/4857/geocentric-models.html#finding-the-posterior-distribution-with-quap-brm.) for translations of `rethinking` code to `brms`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(brms)\n\nbill_depth_brm <-\n  brm(\n    family = gaussian,\n    bill_depth_mm ~ 1,\n    data = penguins,\n    prior = c(\n      prior(normal(20, 6), class = Intercept),\n      prior(uniform(0, 20), class = sigma, ub = 20)\n    ),\n    iter = 1000\n  )\n```\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: Rcpp\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading 'brms' package (version 2.21.0). Useful instructions\ncan be found by typing help('brms'). A more detailed introduction\nto the package is available through vignette('brms_overview').\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'brms'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:ggdist':\n\n    dstudent_t, pstudent_t, qstudent_t, rstudent_t\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:stats':\n\n    ar\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(bill_depth_brm)\n```\n\n::: {.cell-output-display}\n![](components_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(bill_depth_brm)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n Family: gaussian \n  Links: mu = identity; sigma = identity \nFormula: bill_depth_mm ~ 1 \n   Data: penguins (Number of observations: 68) \n  Draws: 4 chains, each with iter = 1000; warmup = 500; thin = 1;\n         total post-warmup draws = 2000\n\nRegression Coefficients:\n          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS\nIntercept    18.42      0.14    18.13    18.70 1.00     1390     1244\n\nFurther Distributional Parameters:\n      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS\nsigma     1.16      0.10     0.98     1.36 1.00     1501     1307\n\nDraws were sampled using sampling(NUTS). For each parameter, Bulk_ESS\nand Tail_ESS are effective sample size measures, and Rhat is the potential\nscale reduction factor on split chains (at convergence, Rhat = 1).\n```\n\n\n:::\n:::\n\n\n### Exploring the posterior\n\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior <- as_draws_df(bill_depth_brm)\n\nhead(posterior)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A draws_df: 6 iterations, 1 chains, and 5 variables\n  b_Intercept sigma Intercept lprior lp__\n1          19   1.2        19   -5.7 -111\n2          18   1.1        18   -5.7 -111\n3          18   1.1        18   -5.7 -111\n4          18   1.1        18   -5.7 -111\n5          18   1.1        18   -5.7 -111\n6          18   1.0        18   -5.7 -111\n# ... hidden reserved variables {'.chain', '.iteration', '.draw'}\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(posterior, aes(Intercept)) +\n  stat_dotsinterval()\n```\n\n::: {.cell-output-display}\n![](components_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggplot(posterior, aes(sigma)) +\n  stat_dotsinterval()\n```\n\n::: {.cell-output-display}\n![](components_files/figure-html/unnamed-chunk-11-2.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_summary(bill_depth_brm)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n               Estimate   Est.Error         Q2.5       Q97.5\nb_Intercept   18.421378 0.140472861   18.1294656   18.696755\nsigma          1.155849 0.098822889    0.9816352    1.359573\nIntercept     18.421378 0.140472861   18.1294656   18.696755\nlprior        -5.741316 0.006166867   -5.7550261   -5.730020\nlp__        -111.280959 1.026213063 -114.1671862 -110.321475\n```\n\n\n:::\n:::\n\n\n## Penguins with a predictor\n\nOK, now let's model bill_depth as a function of bill_length.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(penguins, aes(bill_length_mm, \n                     bill_depth_mm)) +\n  geom_point()\n```\n\n::: {.cell-output-display}\n![](components_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n### Specifying the model\n\n$\\text{billdepth}_i \\sim N(\\mu, \\sigma)$\n\nHere, again, we say that bill depth is normally distributed with some mean and standard deviation.\n\n$\\mu_i = \\alpha + \\beta(\\text{billlength}_i - \\text{mean}(\\text{billlength}))$\n\nThis addition makes it into a linear model.\nInstead of estimating $\\mu$ from the data, we say that the mean of bill depth varies with bill length as linear function with an intercept $\\alpha$ and a slope $\\beta$.\n\n$\\alpha$ and $\\beta$ are now additional parameters that we will estimate and therefore need to set priors for.\n\n$\\alpha \\sim N(20, 6)$\n\n$\\beta \\sim N(0, 5)$\n\n$\\sigma \\sim \\text{Uniform}(0, 20)$\n\n### Exploring the generative model\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprior_draw <- data.frame(\n  bill_length = seq(min(penguins$bill_length_mm), max(penguins$bill_length_mm), length.out = 100),\n  intercept = rnorm(1, 20, 6),\n  beta = rnorm(1, 0, 5),\n  sigma = runif(1, 0, 20)\n) |>\n  mutate(mu = intercept + beta * (bill_length - mean(bill_length))) |>\n  rowwise() |>\n  mutate(sim_depth = rnorm(1, mu, sigma)) \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(prior_draw, aes(bill_length, mu)) +\n  geom_line() +\n  geom_ribbon(aes(ymin = mu - sigma,\n                  ymax = mu + sigma),\n              alpha = .3) +\n  geom_point(aes(y = sim_depth)) +\n  ggtitle(\"Simulated bill depths\",\n          subtitle = \"Based on a single draw from the priors\")\n```\n\n::: {.cell-output-display}\n![](components_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n### Fitting the model (with data)\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndepth_length_brm <- brm(\n  family = gaussian,\n  data = penguins,\n  formula = bill_depth_mm ~ bill_length_mm,\n  prior = c(\n      prior(normal(20, 6), class = Intercept),\n      prior(normal(0, 5), class = b),\n      prior(uniform(0, 20), class = sigma, ub = 20)),\n  iter = 1000\n)\n```\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(depth_length_brm)\n```\n\n::: {.cell-output-display}\n![](components_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(depth_length_brm)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n Family: gaussian \n  Links: mu = identity; sigma = identity \nFormula: bill_depth_mm ~ bill_length_mm \n   Data: penguins (Number of observations: 68) \n  Draws: 4 chains, each with iter = 1000; warmup = 500; thin = 1;\n         total post-warmup draws = 2000\n\nRegression Coefficients:\n               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS\nIntercept          7.57      1.60     4.29    10.62 1.00     1828     1302\nbill_length_mm     0.22      0.03     0.16     0.29 1.00     1803     1301\n\nFurther Distributional Parameters:\n      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS\nsigma     0.88      0.08     0.75     1.05 1.00     2180     1472\n\nDraws were sampled using sampling(NUTS). For each parameter, Bulk_ESS\nand Tail_ESS are effective sample size measures, and Rhat is the potential\nscale reduction factor on split chains (at convergence, Rhat = 1).\n```\n\n\n:::\n:::\n\n\n### Exploring the posterior\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlm_posterior <- as_draws_df(depth_length_brm)\n\nhead(lm_posterior)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A draws_df: 6 iterations, 1 chains, and 6 variables\n  b_Intercept b_bill_length_mm sigma Intercept lprior lp__\n1         7.4             0.23  0.96        19   -8.3  -97\n2         7.0             0.24  0.94        19   -8.3  -96\n3         7.8             0.22  0.89        19   -8.3  -96\n4         7.6             0.23  0.79        19   -8.3  -96\n5         7.4             0.22  0.93        18   -8.3  -96\n6         8.9             0.20  0.92        18   -8.3  -95\n# ... hidden reserved variables {'.chain', '.iteration', '.draw'}\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(lm_posterior, aes(b_Intercept)) +\n  stat_dotsinterval()\n```\n\n::: {.cell-output-display}\n![](components_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggplot(lm_posterior, aes(b_bill_length_mm)) +\n  stat_dotsinterval()\n```\n\n::: {.cell-output-display}\n![](components_files/figure-html/unnamed-chunk-22-2.png){width=672}\n:::\n\n```{.r .cell-code}\nggplot(lm_posterior, aes(sigma)) +\n  stat_dotsinterval()\n```\n\n::: {.cell-output-display}\n![](components_files/figure-html/unnamed-chunk-22-3.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_summary(depth_length_brm)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                    Estimate   Est.Error        Q2.5       Q97.5\nb_Intercept        7.5678375 1.597685969   4.2885750  10.6186846\nb_bill_length_mm   0.2222723 0.032584203   0.1603925   0.2888031\nsigma              0.8829648 0.077046605   0.7505312   1.0523065\nIntercept         18.4222455 0.108770766  18.2085474  18.6326642\nlprior            -8.2705540 0.004796696  -8.2807804  -8.2617956\nlp__             -95.6697446 1.293997087 -99.0571858 -94.2660701\n```\n\n\n:::\n:::\n",
    "supporting": [
      "components_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}